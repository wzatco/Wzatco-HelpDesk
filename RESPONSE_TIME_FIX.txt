REPLACE LINES 175-248 in c:\Rohan\AdminNAgent\pages\api\admin\agents\index.js

WITH THIS CODE:

          // Calculate average response time using messages already loaded with conversations
          let totalResponseTime = 0;
          let responseCount = 0;

          assignedConversations.forEach(ticket => {
            if (ticket.messages && ticket.messages.length > 0) {
              const firstCustomerMsg = ticket.messages.find(m => m.senderType === 'customer');
              const firstAgentReply = ticket.messages.find(m => m.senderType === 'agent' || m.senderType === 'admin');
              
              if (firstCustomerMsg && firstAgentReply) {
                const responseTime = new Date(firstAgentReply.createdAt) - new Date(firstCustomerMsg.createdAt);
                const responseTimeMinutes = responseTime / 60000;
                
                if (responseTimeMinutes > 0 && responseTimeMinutes < 7 * 24 * 60) {
                  totalResponseTime += responseTime;
                  responseCount++;
                }
              }
            }
          });

          const avgResponseTime = responseCount > 0 
            ? Math.round(totalResponseTime / responseCount / 60000)
            : 0;
